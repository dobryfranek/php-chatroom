<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nowa Karta</title>
    
    <style>
    
    body {
        background-color: #2c2b2b;
        color: white;

        margin: 0;
        display: flex;
        flex-direction: column;
        /* justify-content: center; */
        height: 100vh;

        font-family: monospace;
    }

    #chat-container {
        align-self: center;
        width: 50vw;
        height: 90vh;

    }

    .username {
        font-weight: bold;
        color: #8ae234;
    }
    
    
    
    #input-container {
        width: calc(100vw - 1vh);
        height: 9vh;
        margin-top: 1vh;
        margin-left: 1vh;
        
        text-align: left;
        cursor: default;
        float: left;

    }

    #text-input {
        all: unset;
        caret-color: transparent;
        background-color: #2c2b2b;

        cursor: default;

        width: 10vw;
        margin-left: 1ch;
    }

    .cursor {
        width: 1ch;
        height: 1lh;

        display: inline-block;
        position: fixed;
        /* justify-self: left; */
        vertical-align: text-bottom;


        background: white;
        animation: blink 1s step-start infinite;
        /* z-index: 99; */
    }

    @keyframes blink {
        50% {
            opacity: 0;
        }
    }

    ::selection {
        background: white;
        color: #2c2b2b;
    }

    </style>

</head>
<body>

<div id="input-container">
    <span class="username" id="username">anonymous</span>:<input type="text" id="text-input" autocomplete="off" spellcheck="false"><span class="cursor" id="cursor"></span>
</div>


<div id="chat-container">
    
</div>


<script>

let name_span = document.getElementById("username");
let text_input = document.getElementById("text-input");
let cursor_span = document.getElementById("cursor");

function text_input_on_blur () {
    text_input.focus();
}

function text_input_on_input () {
    text_input.style.width = `${text_input.value.length}ch`;
}

function text_input_on_selection () {
    sel_start = text_input.selectionStart;
    sel_end = text_input.selectionEnd;


    name_length = name_span.innerText.length;
    text_input_width = text_input.getBoundingClientRect().width;

    cursor_span.style.left = `calc(${sel_start} * 1ch + ${name_length + 2} * 1ch + 1vh)`;
}

function text_input_on_keyup (event) {
    if (event.key === "Enter") {
        submit_text(text_input.value);
    }
}

text_input.addEventListener("blur", text_input_on_blur);
text_input_on_blur();

text_input.addEventListener("input", text_input_on_input);
text_input_on_input();

text_input.addEventListener("selectionchange", text_input_on_selection);
text_input_on_selection();

function submit_text (text) {
    fetch("back.php", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
            message: text,
        })
    })
}

text_input.addEventListener("keyup", text_input_on_keyup);

</script>



</body>
</html>